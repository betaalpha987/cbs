<!DOCTYPE html>
<html lang="en">
<head>
    <title>Car Benefit Solutions: Task Management</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

    <script src="https://use.fontawesome.com/c18c5c6433.js"></script>

    <link rel="stylesheet" type="text/css" href="css/style.css">

</head>
<body>
    <div class="page-holder">
    
        <div class="container">    
            <div class="row">
                <div class="col-sm-12 top-banner">
                    <div class="banner-text">
                        <h1>Task Management</h1>
                    </div>               
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12"> 
                    <form class="search-form form-inline">
                        <input class="form-control" type="text" placeholder="Search">
                        <button class="btn btn-link" type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                    </form>
                </div>
            </div>
            <!--Later the lines after the header should be procedurally generated-->
            <div class="row">
                <div class="col-sm-12">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>&nbsp;</th>
                                <th>Date</th>
                                <th>Quote Number</th>
                                <th>Dealer</th>
                                <th>Name</th>
                                <th>Registration Number</th>
                                <th>Vehicle</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="delivTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>

        $(document).ready(function(){

            var jGet = $.getJSON( "https://betaalpha987.github.io/cbs/Test-Data.json").always(function() {
                if (jGet.status !== 200) {
                    alert("Error " + jGet.status + ": " + jGet.statusText);
                    return;
                }
                // console.log(jGet);
                var delivData = JSON.parse(jGet.responseText);
                populateTable(delivData);
            });
        });

        function toggleDetails(id) {
            trDetails = $(id);
            trDetails.css("display", trDetails.css("display") === "none" ? "table-row" : "none" ); 
        }

        function longDate(dt) {
            if (dt) {
                var month = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
                    return (dt.getDate() + " " + month[dt.getMonth()] + " " + dt.getFullYear());
                }
            }
        function shortDate(dt) {
            if (dt) {
                var m = dt.getMonth()+1;
                if (m < 10) m = "0"+m;
                console.log(dt);
                // Reversed for use in date fields on the form
                return (dt.getFullYear() + "-" + m + "-" + dt.getDate());
            }
        }

        function txtToDateObj(elem) {
            if (elem) elem = new Date(elem);
        }

        function populateTable(data) {
            var htmlInsert = "";
            data.forEach(function(e) {
                
                if (e.quoteDate) e.quoteDate = new Date(e.quoteDate);
                if (e.statusDate) e.statusDate = new Date(e.statusDate);
                if (e.regDate) e.regDate = new Date(e.regDate);
                if (e.contractStartDate) e.contractStartDate = new Date(e.contractStartDate);
                if (e.contractEndDate) e.contractEndDate = new Date(e.contractEndDate);
                if (e.estDeliveryDate) e.estDeliveryDate = new Date(e.estDeliveryDate);
                if (e.actualDeliveryDate) e.actualDeliveryDate = new Date(e.actualDeliveryDate);
                if (e.taxExpiryDate) e.taxExpiryDate = new Date(e.taxExpiryDate);

                var isDelivCheckboxYes = e.isDelivered === true? "checked" : "";
                var isDelivCheckboxNo = e.isDelivered !== true? "checked" : "";
                var inStockCheckboxYes = e.isDelivered === true? "checked" : "";
                var inStockCheckboxNo = e.isDelivered !== true? "checked" : "";

                htmlInsert +=
                    `
                        <tr>
                            <th scope="row">
                                <a onclick="toggleDetails('#tr${e.quoId}')">
                                    <i class="fa fa-plus-circle" aria-hidden="true"></i>
                                </a>
                            </th>
                            <td>${longDate(e.quoteDate)}</td>
                            <td>${e.quoId}</td>
                            <td>${e.clientName}</td>
                            <td>${e.driverName}</td>
                            <td>${e.regNumber}</td>
                            <td>${e.vehicleDescription}</td>
                            <td><i class="fa fa-cog" aria-hidden="true"></i><i class="fa fa-angle-down" aria-hidden="true"></i></td>
                        </tr>
                        <tr id="tr${e.quoId}" style="display: none;">
                            <td colspan="8">
                                <div class="row">
                                    <div class="col"> 
                                        Order summary
                                        <hr>
                                        Confirm Delivery
                                    </div>
                                </div>
                                <div class="row">
                                    <form class="form-inline">
                                        <div class="col-5">
                                            <div class="form-group row">
                                                <label for="drivername" class="col-4">Driver Name</label>
                                                <div class="col-8">
                                                    <input type="text" required class="form-control" id="drivername" value="${e.driverName}">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="delivdate" class="col-4">Est. Delivery Date</label>
                                                <div class="col-8">
                                                        <input type="date" required class="form-control" id="delivdate" value="${shortDate(e.estDeliveryDate) || ''}">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label class="col-4">In Stock</label>
                                                <div class="col-2">
                                                    <label class="form-check-label">
                                                        <input type="radio" class="form-check-input" name="instock" id="instock1" value="No" ${isDelivCheckboxNo}>
                                                            No
                                                    </label>
                                                </div>
                                                <div class="col-2">
                                                    <label class="form-check-label">
                                                        <input type="radio" class="form-check-input" name="instock" id="instock2" value="Yes" ${isDelivCheckboxYes}>
                                                            Yes
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label class="col-4">Vehicle Delivered</label>
                                                <div class="col-2">
                                                    <label class="form-check-label">
                                                        <input type="radio" class="form-check-input" name="delivered" id="delivered1" value="No" ${inStockCheckboxNo}>
                                                            No
                                                    </label>
                                                </div>
                                                <div class="col-2">
                                                    <label class="form-check-label">
                                                        <input type="radio" class="form-check-input" name="delivered" id="delivered2" value="Yes" ${inStockCheckboxYes}>
                                                            Yes
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="regnum" class="col-4">Registration Number</label>
                                                <div class="col-8">
                                                        <input type="text" required class="form-control" id="regnum" value="${e.regNumber}">
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label for="vinnum" class="col-4">Vin Number</label>
                                                <div class="col-8">
                                                    <input type="text" required class="form-control" id="vinnum" value="${e.vinNumber}">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-5">
                                            <div class="form-group row">
                                                <label for="regdate" class="col-4">Registration Date</label>
                                                <div class="col-8">
                                                    <input type="date" required class="form-control" id="regdate" value="${shortDate(e.regDate) || ''}">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="taxexpdate" class="col-4">Tax Expiry Date</label>
                                                <div class="col-8">
                                                    <input type="date" required class="form-control" id="taxexpdate" value="${shortDate(e.taxExpiryDate) || ''}">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="actdelivdate" class="col-4">Actual Delivery Date</label>
                                                <div class="col-8">
                                                    <input type="date" required class="form-control" id="actdeldate" value="${shortDate(e.actualDeliveryDate) || ''}">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="endcontract" class="col-4">End Of Contract</label>
                                                <div class="col-8">
                                                    <input type="date" required class="form-control" id="endcontract" value="${shortDate(e.contractEndDate) || ''}">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-2">
                                            <button type="submit">Confirm Delivery</button>
                                        </div>

                                    </form>
                                </div>
                            </td>
                        </tr>

                    `;
            });

            $("#delivTable").html(htmlInsert);

        }



    </script>
</body>
</html>
